var DynamoDB
module.exports = function($config) {
	DynamoDB = require('aws-dynamodb')($config)
	
	return {
		Stats: new Stats(),
		Logs: null
	}
}

Stats = function() {

}
Stats.prototype.inc = function( $tenant, $type, $keys, callback ) {
	var $d = new Date()
	var $date = ''

	if ($type == 'MONTH')
		$date = 'MONTH ' + $d.getFullYear() + '-' + ('0' + ($d.getMonth() + 1)).substr(-2)

	if ($type == 'DAY')
		$date = 'DAY ' +  $d.getFullYear() + '-' + ('0' + ($d.getMonth() + 1)).substr(-2) + '-' + ( '0' + $d.getDate()).substr(-2)
		
	if ($type == 'HOUR')
		$date = 'HOUR ' + $d.getFullYear() + '-' + ('0' + ($d.getMonth() + 1)).substr(-2) + '-' + ( '0' + $d.getDate()).substr(-2) + ' ' + ('0' + $d.getHours()).substr(-2)		

	DynamoDB
		.table('stats')
		.where('site').eq($tenant)
		.where('date').eq($date)
		.increment($keys,function( err, data ) {
			if (err) {
				// its probably insert error ?
				$keys['site'] = $tenant
				$keys['date'] = $date
				DynamoDB
					.table('stats')
					.insert($keys, function( err, data ) {
						if (err )
							callback(err)
						else 
							callback(false)
					})
			} else {
				callback(false)
			}
			
		})
}